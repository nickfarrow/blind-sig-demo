<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <!-- Primary Meta Tags -->
    <title>Blind Schnorr Signature Interactive Demo</title>
    <meta name="title" content="Blind Schnorr Signature Interactive Demo" />
    <meta
      name="description"
      content="Blind sign a Nostr event and post it in this interactive cryptography demo! Click through the steps!"
    />

    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website" />
    <meta property="og:url" content="https://blindsigs.utxo.club/" />
    <meta
      property="og:title"
      content="Blind Schnorr Signature Interactive Demo"
    />
    <meta
      property="og:description"
      content="Blind sign a Nostr event and post it in this interactive cryptography demo! Click through the steps!"
    />
    <meta
      property="og:image"
      content="https://blindsigs.utxo.club/header.png"
    />

    <!-- Twitter -->
    <meta property="twitter:card" content="summary_large_image" />
    <meta property="twitter:url" content="https://blindsigs.utxo.club/" />
    <meta
      property="twitter:title"
      content="Blind Schnorr Signature Interactive Demo"
    />
    <meta
      property="twitter:description"
      content="Blind sign a Nostr event and post it in this interactive cryptography demo! Click through the steps!"
    />
    <meta
      property="twitter:image"
      content="https://blindsigs.utxo.club/header.png"
    />

    <!-- bootstrap -->
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css"
      integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm"
      crossorigin="anonymous"
    />
    <script
      src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.3/jquery.min.js"
      integrity="sha512-STof4xm1wgkfm7heWqFJVn58Hm3EtS31XFaagaa8VMReCXAkQnJZ+jEy8PCC/iT18dFy95WcExNHFTqLyp72eQ=="
      crossorigin="anonymous"
      referrerpolicy="no-referrer"
    ></script>
    <script
      src="https://cdn.jsdelivr.net/npm/popper.js@1.14.7/dist/umd/popper.min.js"
      integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1"
      crossorigin="anonymous"
    ></script>
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@4.3.1/dist/js/bootstrap.min.js"
      integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM"
      crossorigin="anonymous"
    ></script>

    <!-- MathJax -->
    <script
      id="MathJax-script"
      async
      src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"
    ></script>

    <!-- Style -->
    <link rel="stylesheet" href="/style.css" />

    <script src="script.js"></script>
  </head>
  <body>
    <!-- Load Rust WASM -->
    <script type="module">
      import init, { greet } from "./pkg/client.js";
      async function run() {
        await init();
        greet();
      }

      run();
    </script>
    <div class="main-container">
      <h1>Blind Schnorr Signatures<br />Interactive Demo</h1>
      <h2>
        Disguise a <span style="color: blueviolet">Nostr</span> event, ask the
        server to blindly sign, then unblind &amp; post!
      </h2>

      <p>
        <a
          href="https://en.wikipedia.org/wiki/Schnorr_signature"
          target="_blank"
          >Schnorr signatures</a
        >
        let a signer prove they signed a message using their secret key.
        <b>Blind signatures</b> take this a step further -- you can sign a
        message without ever knowing the contents of what you are signing.
      </p>
      <p>
        A user disguises their message, has the server sign the disguised
        message, then unblinds the result -- producing a valid signature that
        the server can't link back to the message it signed.
      </p>
      <p>
        This is powerful for <b>privacy</b>: a server can act as an authority
        while remaining blind to the contents of the data it is authorising. See
        this
        <a
          href="https://suredbits.com/schnorr-applications-blind-signatures/"
          target="_blank"
          >article by Nadav @ suredbits</a
        >
        for more on the math.
      </p>

      <h2>Follow steps 1&ndash;7</h2>

      <!-- Step 1: Generate Nonce (SERVER) -->
      <div class="step-card step-server" id="nonce-gen-div">
        <span class="badge badge-server">SERVER</span>
        <h2>1. Generate a nonce</h2>
        <p>
          The server has a private key \(x\) and public key \(X = x*G\).
          <br />
          <small>
            (\(G\) is the generator point of an elliptic curve -- it is
            impossible to find \(x\) from knowing \(X\)).
          </small>
        </p>
        <p>
          Server generates a random secret \(k\) and public nonce \(R=k*G\).
        </p>
        <form id="gennonce" onsubmit="return request_nonce()">
          <input
            class="button"
            type="submit"
            id="usenonce_button"
            value="Generate Nonce"
          />
        </form>
        <br />
        <div class="output-field">
          <div class="output-label">Server Public Key \(X\)</div>
          <div
            class="output-value"
            id="server_pubkey"
            onclick="copyField(this)"
          ></div>
        </div>
        <div class="output-field">
          <div class="output-label">Nonce \(R\)</div>
          <div class="output-value" id="nonce" onclick="copyField(this)"></div>
        </div>
      </div>

      <!-- Step 2: Choose a message (USER) -->
      <div
        class="step-card step-user"
        id="enter-message-div"
        style="visibility: visible"
      >
        <span class="badge badge-user">USER</span>
        <h2>2. Choose a message</h2>
        <p>Choose a message for the server to blindly sign \(m\).</p>
        <form id="blind" onsubmit="return use_message()">
          <label>Enter a message:</label>
          <input
            style="display: inline"
            class="w-50"
            name="message"
            id="message_input"
            required
          />
          <input
            class="button"
            type="submit"
            onclick="javascript:document.getElementById('create-nostr-div').style.display = 'inline'; return true;"
            value="Raw"
          />
        </form>
        <br />
        <div id="create-nostr-div" style="display: none">
          <p>
            <span id="create-nostr-wasm-button" style="display: none"></span>
            (optional)
          </p>
          <div id="unsigned-nostr-event" style="display: none">
            <p><b>&lt;Unsigned Nostr Event&gt;</b></p>
            <pre class="nostr-json" id="nostr_event"></pre>
          </div>
        </div>
        <span id="original_message" style="display: none"></span>
        <div class="output-field">
          <div class="output-label">Message \(m\)</div>
          <div
            class="output-value"
            id="message"
            onclick="copyField(this)"
          ></div>
        </div>
      </div>

      <!-- Step 3: Generate blinding values (USER) -->
      <div
        class="step-card step-user"
        id="create-blindings-div"
        style="visibility: hidden"
      >
        <span class="badge badge-user">USER</span>
        <h2>3. Generate blinding values</h2>
        <p>
          Generate two random scalar values \(\alpha\) and \(\beta\). These will
          be used to blind (disguise) what we request the server to sign.
        </p>
        <div id="create-blindings-wasm-button"></div>
        <small
          >Blinding values are generated locally in your browser using
          WASM.</small
        >
        <br /><br />
        <div class="output-field">
          <div class="output-label">Alpha \(\alpha\)</div>
          <div class="output-value" id="alpha" onclick="copyField(this)"></div>
        </div>
        <div class="output-field">
          <div class="output-label">Beta \(\beta\)</div>
          <div class="output-value" id="beta" onclick="copyField(this)"></div>
        </div>
      </div>

      <!-- Step 4: Apply blindings (USER) -->
      <div
        class="step-card step-user"
        id="apply-blindings-div"
        style="visibility: hidden"
      >
        <span class="badge badge-user">USER</span>
        <h2>4. Apply blindings</h2>
        <p>Blind the nonce \(R' = R + \alpha*G + \beta*X\).</p>
        <p>
          Create a challenge \(c = H(X, R', m)\) using hash function \(H\), then
          blind it \(c' = c + \beta\).
        </p>
        <form id="apply_blindings" onsubmit="return hit_apply_bindings()">
          <input class="button" type="submit" value="Apply blindings" />
        </form>
        <small
          >Uses WASM to locally blind the nonce and create a challenge.</small
        >
        <br />
        <div id="blinded_values" style="display: none">
          <div class="output-field">
            <div class="output-label">Blinded nonce \(R'\)</div>
            <div
              class="output-value"
              id="blinded_nonce"
              onclick="copyField(this)"
            ></div>
          </div>
          <div class="output-field">
            <div class="output-label">Challenge \(c'\)</div>
            <div
              class="output-value"
              id="blinded_challenge"
              onclick="copyField(this)"
            ></div>
          </div>
        </div>
      </div>

      <!-- Step 5: Sign blinded challenge (SERVER) -->
      <div
        class="step-card step-server"
        id="sign-challenge-div"
        style="visibility: hidden"
      >
        <span class="badge badge-server">SERVER</span>
        <h2>5. Sign blinded challenge</h2>
        <p>
          Request the server to produce a signature using nonce secret \(k\) and
          private key \(x\): \(s = k + c'*x\).
        </p>
        <form id="sign" onsubmit="return request_sign()">
          <div class="output-field">
            <div class="output-label">Public Nonce \(R\)</div>
            <div
              class="output-value"
              id="usednonce_signform"
              onclick="copyField(this)"
            ></div>
          </div>
          <div class="output-field">
            <div class="output-label">Blinded Challenge \(c'\)</div>
            <div
              class="output-value"
              id="challenge_signform"
              onclick="copyField(this)"
            ></div>
          </div>
          <input class="button" type="submit" value="Sign challenge" />
        </form>
        <div class="output-field">
          <div class="output-label">Signature \(s\)</div>
          <div
            class="output-value"
            id="blinded_signature"
            onclick="copyField(this)"
          ></div>
        </div>
      </div>

      <!-- Step 6: Unblind signature (USER) -->
      <div
        class="step-card step-user"
        id="unblind-signature-div"
        style="visibility: hidden"
      >
        <span class="badge badge-user">USER</span>
        <h2>6. Unblind signature</h2>
        <p>
          Use the blinding values to get the tweaked signature \(s' = s +
          \alpha\).
        </p>
        <div id="unblind-signature-wasm-button"></div>
        <small>Locally unblind the signature using WASM.</small>
        <br />
        <div class="output-field">
          <div class="output-label">Unblinded signature \(s'\)</div>
          <div
            class="output-value"
            id="unblinded_signature"
            onclick="copyField(this)"
          ></div>
        </div>
      </div>

      <hr style="border-color: white; height: 3px" />

      <!-- Step 7: Verify signature -->
      <div id="bottom-row-div" style="visibility: hidden">
        <div class="step-card step-server">
          <span class="badge badge-server">SERVER</span>
          <h2>7. Verify signature</h2>
          <p>
            Once the user shares the signature-nonce pair \((s', R')\), anyone
            can verify it solves the schnorr verification equation \(s' * G = R'
            + c*X\) for challenge \(c\) belonging to message \(m\).
          </p>
          <p>
            Most importantly,
            <b>the server has no way of correlating</b> this signature-nonce
            pair with the challenge and nonce they signed with earlier.
          </p>
          <form id="verify" onsubmit="return request_verify()">
            <div class="output-field">
              <div class="output-label">Publickey</div>
              <div
                class="output-value"
                id="pubkey_verifyform"
                onclick="copyField(this)"
              ></div>
            </div>
            <div class="output-field">
              <div class="output-label">Message</div>
              <div
                class="output-value"
                id="message_verifyform"
                onclick="copyField(this)"
              ></div>
            </div>
            <p>
              <b>Signature</b>:
              <input
                id="signature_verifyform"
                class="w-75"
                placeholder="Paste signature here"
              />
            </p>
            <div class="output-field">
              <div class="output-label">Blinded nonce</div>
              <div
                class="output-value"
                id="blinded_nonce_verifyform"
                onclick="copyField(this)"
              ></div>
            </div>
            <input
              class="button"
              type="submit"
              value="Verify Unblinded Signature"
            />
          </form>
          <p><b>Valid?</b>: <span id="verify_success"></span></p>
        </div>

        <!-- Broadcast Nostr -->
        <div
          class="step-card step-user"
          id="broadcast-nostr-div"
          style="display: none"
        >
          <span class="badge badge-user">USER</span>
          <h2>Broadcast Nostr event</h2>
          <div id="add-signature-button-wasm"></div>
          <div id="signed-event-display" style="display: none">
            <b>&lt;Signed Nostr Event&gt;</b>
            <pre class="nostr-json" id="signed_nostr_event"></pre>
            <div id="broadcast-nostr-button-wasm"></div>
            <p id="njump-link" style="display: none"></p>
          </div>
          <br />
        </div>

        <!-- Proof -->
        <div class="step-card step-server">
          <h2>Schnorr Verification Equation</h2>
          <p>
            Show \((s', R')\) solves the schnorr verification equation \((s' * G
            = R' + c*X)\) for challenge \(c\) under public key \(X\):
          </p>
          <small
            >Hint: Expand \(s'\) from definitions (plug and chug the
            algebra)</small
          >
          <br /><br />
          <button
            type="button"
            class="button"
            data-toggle="collapse"
            data-target="#proof"
            aria-expanded="false"
            aria-controls="proof"
          >
            Reveal proof
          </button>
          <div class="collapse" id="proof">
            <!-- prettier-ignore -->
            <div class="card card-body">Starting with the blinded signature:
                                $$\begin{aligned} s' &= s + \alpha
                                \\ &= (k + c'*x) + \alpha
                                \\ &= k + (c+\beta)*x + \alpha
                                \\ &= (k + \alpha + \beta*x) + c*x
                                \end{aligned}$$

                                so
                                $$\begin{aligned} s'*G &= ((k + \alpha + \beta*x) + c*x)*G
                                \\ &= (k + \alpha + \beta*x)*G + c*(x*G)
                                \\ &= k*G + \alpha*G + \beta*(x*G) + c*(x*G)
                                \\ &= (R + \alpha*G + \beta*X) + c*X
                                \\ &= R' + c*X
                                \end{aligned}$$
                            </div>
          </div>
        </div>

        <!-- Thanks -->
        <div id="thanks" style="display: none">
          <h2>Thanks for trying!</h2>
          <p>
            <b>Code:</b> check out the
            <a href="https://github.com/LLFourn/secp256kfun/pull/98"
              >blind schnorr signature PR to secp256kfun</a
            >! <br /><br />
            <b>Why?</b> Blind signatures enable powerful privacy
            patterns: a server can authenticate or authorize user actions
            without learning what those actions are. Think anonymous
            credentials, private voting, or unlinkable access tokens.
            An authority can verify you're allowed to do something
            without ever seeing what you did.
            <br /><br />
            <b>My nonce expired!</b> Currently the server only allows one
            signing session at a time, to prevent
            <a
              href="https://www.iacr.org/archive/crypto2002/24420288/24420288.pdf"
              target="_blank"
              >Wagner attacks</a
            >
            (concurrent sessions can allow forgery).
          </p>
          <pre class="addresses" id="ln_addy"></pre>
          <img
            style="
              max-width: 150px;
              display: block;
              margin-left: auto;
              margin-right: auto;
            "
            id="qr"
            src=""
          />
          <p>
            <a href="https://pay.utxo.club/" target="_blank"
              >Donate</a
            >
          </p>
          <script type="text/javascript">
            var invoiceData = { amount: "47474", method: "lightning" };
            $.get("https://pay.utxo.club/api/createpayment", invoiceData).then(
              function (data) {
                invoice = data.invoice;
                payment_uuid = invoice.uuid;
                $("#ln_addy").text(invoice.address).html();
                document.getElementById("qr").src =
                  "https://pay.utxo.club/static/qr_codes/" +
                  payment_uuid +
                  ".png";
                return payment_uuid;
              }
            );
            document.getElementById("thanks").style.display = "inline";
          </script>
        </div>
      </div>
      <p style="text-align: center; margin-top: 40px; font-size: 0.8em;">
        made with love by <a href="https://utxo.club" target="_blank">utxo.club</a>
      </p>
    </div>
  </body>
</html>
